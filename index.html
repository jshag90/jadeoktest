<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <meta name="google-adsense-account" content="ca-pub-6669682457787065" />
    <title>자덕력 테스트</title>
    <meta property="og:type" content="website" />
    <meta property="og:title" content="자덕력 테스트" />
    <meta
      property="og:description"
      content="당신의 자덕력을 테스트해보세요! 자전거에 대한 당신의 열정을 점수로 환산합니다."
    />
    <meta
      name="description"
      content="당신의 자덕력을 테스트해보세요! 자전거에 대한 당신의 열정을 점수로 환산합니다."
    />
    <meta
      property="og:image"
      content="https://jadeoktest.web.app/jadeoktest_logo.png"
    />
    <meta property="og:url" content="https://jadeoktest.web.app" />
    <meta
      name="naver-site-verification"
      content="f3e077ef88a458aee9e127cda3328c2ece62eb07"
    />
    <link href="styles.css" rel="stylesheet" />
    <link rel="icon" href="bike.ico" type="image/x-icon" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body>
    <header class="top-header">
      🚴 자덕력 테스트
      <button
        id="menu-btn"
        style="
          position: absolute;
          right: 20px;
          top: 50%;
          transform: translateY(-50%);
          background: none;
          border: none;
          font-size: 2rem;
          color: white;
          cursor: pointer;
        "
        aria-label="메뉴 열기"
      >
        &#9776;
      </button>
      <nav
        id="menu-nav"
        style="
          display: none;
          position: absolute;
          top: 80px;
          right: 20px;
          background: rgba(0, 0, 0, 0.95);
          border-radius: 16px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
          padding: 1rem 2rem;
          z-index: 10000;
          min-width: 180px;
        "
      >
        <ul style="list-style: none; margin: 0; padding: 0">
          <li>
            <a
              href="./"
              style="
                color: white;
                text-decoration: none;
                font-weight: 600;
                display: block;
                padding: 0.5rem 0;
              "
              >자덕력 테스트</a
            >
          </li>
          <li>
            <a
              href="./cycle-game.html"
              style="
                color: white;
                text-decoration: none;
                font-weight: 600;
                display: block;
                padding: 0.5rem 0;
              "
              >자덕력 미니게임</a
            >
          </li>
        </ul>
      </nav>
      <script>
        const menuBtn = document.getElementById("menu-btn");
        const menuNav = document.getElementById("menu-nav");
        menuBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          menuNav.style.display =
            menuNav.style.display === "block" ? "none" : "block";
        });
        document.addEventListener("click", function (e) {
          if (
            menuNav.style.display === "block" &&
            !menuNav.contains(e.target) &&
            e.target !== menuBtn
          ) {
            menuNav.style.display = "none";
          }
        });
      </script>
    </header>

    <div id="slider" class="container">
      <div class="slide">
        <div class="question">1. FTP 테스트가 무엇인지 알고 있다.</div>
        <div class="buttons">
          <button class="btn" data-score="10">예</button>
          <button class="btn" data-score="0">아니오</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">2. 스트라바는 매일 확인한다.</div>
        <div class="buttons">
          <button class="btn" data-score="10">예</button>
          <button class="btn" data-score="0">아니오</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">3. 자전거 탈 때 파워미터를 사용한다.</div>
        <div class="buttons">
          <button class="btn" data-score="10">예</button>
          <button class="btn" data-score="0">아니오</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">4. 평소 주말에 주로 뭘 하시나요?</div>
        <div class="buttons">
          <button class="btn" data-score="10">라이딩</button>
          <button class="btn" data-score="3">등산</button>
          <button class="btn" data-score="0">집콕</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">5. 자전거 정비는 어떻게 하나요?</div>
        <div class="buttons">
          <button class="btn" data-score="10">내가 직접</button>
          <button class="btn" data-score="5">샵에 맡김</button>
          <button class="btn" data-score="0">안 함</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">6. 보유 중인 자전거 수는?</div>
        <div class="buttons">
          <button class="btn" data-score="10">2대 이상</button>
          <button class="btn" data-score="5">1대</button>
          <button class="btn" data-score="0">없음</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">7. 자전거 여행(투어)을 떠나본 적이 있다.</div>
        <div class="buttons">
          <button class="btn" data-score="10">예</button>
          <button class="btn" data-score="0">아니오</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">8. 자전거 동호회 가입 여부는?</div>
        <div class="buttons">
          <button class="btn" data-score="10">예</button>
          <button class="btn" data-score="0">아니오</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">9. 자전거 관련 유튜브 채널을 구독하고 있다.</div>
        <div class="buttons">
          <button class="btn" data-score="10">예</button>
          <button class="btn" data-score="0">아니오</button>
        </div>
      </div>
      <div class="slide">
        <div class="question">
          10. 자전거 용품(헬멧, 의류 등)에<br />
          관심이 많다.
        </div>
        <div class="buttons">
          <button class="btn" data-score="10">매우 그렇다</button>
          <button class="btn" data-score="5">보통이다</button>
          <button class="btn" data-score="0">별로 없다</button>
        </div>
      </div>

      <div class="slide result-slide">
        <div id="capture-area">
          <h2 id="capture-title">🚴 자덕력 테스트</h2>
          <div class="result" id="result">결과 계산 중...</div>
          <img id="preview" src="#" alt="내 자전거 이미지" />
        </div>

        <p class="upload-message">
          🚴 나만의 자전거 사진과 함께<br />자덕력 인증샷 공유해요!
        </p>

        <div class="file-input-wrapper">
          <input type="file" id="imageUpload" accept="image/*" />
          <label for="imageUpload" class="file-input-label"
            >📷 사진 업로드</label
          >
        </div>

        <div class="share-buttons">
          <button onclick="restartTest()">🔄 다시하기</button>
          <button onclick="downloadImage()">💾 결과 이미지 저장</button>
          <button onclick="shareResult()">📤 공유하기</button>
        </div>
      </div>
    </div>

    <script>
      const slider = document.getElementById("slider");
      const slides = document.querySelectorAll(".slide");
      const totalSlides = slides.length - 1;
      const buttons = document.querySelectorAll(".btn");
      const resultText = document.getElementById("result");
      const imageUpload = document.getElementById("imageUpload");
      const preview = document.getElementById("preview");

      let currentSlide = 0;
      let score = 0;
      let resultString = "";

      const goToNextSlide = () => {
        currentSlide++;
        slider.style.transform = `translateX(-${100 * currentSlide}vw)`;
        if (currentSlide === totalSlides) {
          showResult();
        }
      };

      const showResult = () => {
        let message = "";
        if (score <= 20) {
          message =
            "🟢 입문 자덕\n아직 자덕의 길은 멀어요!\n자전거의 세계에 오신 걸 환영합니다.";
        } else if (score <= 50) {
          message =
            "🔵 중급 자덕\n조금씩 덕후의 기운이 느껴져요!\n이제 자전거가 친구보다 더 좋아질지도?";
        } else if (score <= 70) {
          message =
            "🔧 상급 자덕\n제법 진심이네요.\n자전거 없이는 못 사는 단계!";
        } else if (score < 90) {
          message =
            "🚴‍♂️ 최상급 자덕\n완벽한 자덕, 존경합니다.\n동호회에서 이미 유명인!";
        } else {
          message =
            "🌟 레전드 자덕\n자전거가 곧 인생!\n자덕계의 신, 당신을 모두가 우러러봅니다!";
        }

        // 공유용 텍스트 (순수 텍스트)
        resultString = `당신은 ${message}\n총 점수: ${score}점`;

        // 화면 표시용 HTML
        const displayHTML = `당신은 ${message.replace(
          /\n/g,
          "<br>"
        )} <br>총 점수: ${score}점`;
        resultText.innerHTML = displayHTML;
      };

      buttons.forEach((btn) =>
        btn.addEventListener("click", (e) => {
          const value = parseInt(e.target.getAttribute("data-score"));
          score += value;
          goToNextSlide();
        })
      );

      // 이미지 업로드 미리보기
      imageUpload.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      });

      // 공유 기능 (사용하지 않는 함수 제거)
      function share() {
        shareResult();
      }

      function downloadImage() {
        const captureArea = document.getElementById("capture-area");

        // 캡처 전에 원래 스타일 저장
        const originalStyle = captureArea.style.cssText;

        // 배경과 글자색 지정 - 투명도 문제 해결
        captureArea.style.background =
          "linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)"; // 하늘색 그라데이션
        captureArea.style.color = "#0D1B2A";
        captureArea.style.padding = "2rem";
        captureArea.style.borderRadius = "20px";
        captureArea.style.backdropFilter = "none"; // backdrop-filter 제거
        captureArea.style.backgroundColor = "#E3F2FD"; // 하늘색 배경

        // 자식 요소 글자색도 강제 설정 - !important 사용
        captureArea.querySelectorAll("*").forEach((el) => {
          el.style.setProperty("color", "#0D1B2A", "important");
          el.style.setProperty("opacity", "1", "important");
          el.style.setProperty("font-weight", "700", "important");
          el.style.setProperty("text-shadow", "none", "important");
          el.style.setProperty("background-color", "transparent", "important");
          // backdrop-filter가 있는 요소들도 제거
          if (el.style.backdropFilter) {
            el.style.setProperty("backdrop-filter", "none", "important");
          }
        });

        const title = document.getElementById("capture-title");
        if (title) {
          title.style.setProperty("color", "#0D1B2A", "important");
          title.style.setProperty("font-weight", "700", "important");
          title.style.setProperty("text-shadow", "none", "important");
          title.style.setProperty("opacity", "1", "important");
        }

        const result = document.getElementById("result");
        if (result) {
          result.style.setProperty("color", "#0D1B2A", "important");
          result.style.setProperty("font-weight", "700", "important");
          result.style.setProperty("opacity", "1", "important");
          result.style.setProperty("text-shadow", "none", "important");
          // 결과 텍스트의 모든 자식 요소도 강제 설정
          result.querySelectorAll("*").forEach((el) => {
            el.style.setProperty("color", "#0D1B2A", "important");
            el.style.setProperty("opacity", "1", "important");
            el.style.setProperty("font-weight", "700", "important");
            el.style.setProperty("text-shadow", "none", "important");
          });
        }

        // 스타일 적용 대기 후 캡처
        setTimeout(() => {
          html2canvas(captureArea, {
            backgroundColor: "#E3F2FD", // 하늘색 배경색 설정
            scale: 2,
            logging: false,
            useCORS: true,
            allowTaint: true,
            ignoreElements: (element) => {
              // 외부 리소스나 문제가 될 수 있는 요소들 무시
              return (
                element.tagName === "LINK" ||
                element.tagName === "SCRIPT" ||
                element.classList.contains("top-header")
              );
            },
            onclone: (clonedDoc) => {
              // 클론된 문서에서 추가 스타일 적용
              const clonedCaptureArea =
                clonedDoc.getElementById("capture-area");
              if (clonedCaptureArea) {
                clonedCaptureArea.style.background =
                  "linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)";
                clonedCaptureArea.style.color = "#0D1B2A";
                clonedCaptureArea.style.opacity = "1";

                // 클론된 문서의 모든 텍스트 요소에 강제 스타일 적용
                clonedCaptureArea.querySelectorAll("*").forEach((el) => {
                  el.style.setProperty("color", "#0D1B2A", "important");
                  el.style.setProperty("opacity", "1", "important");
                  el.style.setProperty("font-weight", "700", "important");
                  el.style.setProperty("text-shadow", "none", "important");
                });
              }
            },
          })
            .then((canvas) => {
              const link = document.createElement("a");
              link.download = "자덕력 테스트 결과.png";
              link.href = canvas.toDataURL("image/png");
              link.click();

              // 원래 스타일 복원
              captureArea.style.cssText = originalStyle;
            })
            .catch((error) => {
              console.error("이미지 생성 실패:", error);
              alert("이미지 저장에 실패했습니다. 다시 시도해주세요.");

              // 에러 발생 시에도 복원
              captureArea.style.cssText = originalStyle;
            });
        }, 100);
      }

      function shareResult() {
        const shareUrl = "https://jadeoktest.web.app/";
        const appUrl =
          "https://play.google.com/store/apps/details?id=com.dodam.bicycleairpressuremaster";
        const shareText = `\n${resultString}

자덕력 테스트 바로가기: ${shareUrl}

자전거공기압계산기 앱 다운로드:${appUrl}`;

        console.log("공유할 텍스트: " + shareText);

        if (navigator.share) {
          navigator
            .share({
              title: "[자덕력 테스트]",
              text: shareText,
            })
            .catch((err) => {
              console.log("공유 취소 또는 실패");
              copyToClipboard(shareText);
            });
        } else {
          copyToClipboard(shareText);
        }
      }

      function copyToClipboard(text) {
        const textToCopy =
          text ||
          `${resultString}\n\n자덕력 테스트 바로가기: https://jadeoktest.web.app\n\n자전거공기압계산기 앱 다운로드: https://play.google.com/store/apps/details?id=com.dodam.bicycleairpressuremaster`;

        navigator.clipboard
          .writeText(textToCopy)
          .then(() => {
            alert("결과가 클립보드에 복사되었습니다!");
          })
          .catch(() => {
            // 클립보드 API가 실패할 경우 대체 방법
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            alert("결과가 클립보드에 복사되었습니다!");
          });
      }

      function restartTest() {
        currentSlide = 0;
        score = 0;
        resultString = "";

        // 페이지를 최상단으로 스크롤
        window.scrollTo(0, 0);

        // 슬라이더를 첫 번째 슬라이드로 이동
        slider.style.transform = "translateX(0)";

        // 결과 텍스트 초기화
        resultText.innerHTML = "결과 계산 중...";

        // 이미지 미리보기 초기화
        preview.style.display = "none";
        preview.src = "#";

        // 파일 입력 초기화
        imageUpload.value = "";

        // 모든 버튼의 선택 상태 초기화 (시각적 피드백을 위해)
        buttons.forEach((btn) => {
          btn.style.transform = "translateY(0) scale(1)";
          btn.style.boxShadow = "0 4px 15px rgba(0, 0, 0, 0.1)";
        });
      }

      // 더블클릭(더블탭) 방지
      document.addEventListener("dblclick", function (e) {
        e.preventDefault();
      });

      // 모바일 더블탭 확대 방지
      let lastTouch = 0;
      document.addEventListener(
        "touchstart",
        function (e) {
          const now = Date.now();
          if (now - lastTouch <= 350) {
            e.preventDefault();
          }
          lastTouch = now;
        },
        { passive: false }
      );
    </script>
    <footer class="modern-footer">
      <div class="footer-content">
        <div class="app-promotion">
          <span class="app-icon">📱</span>
          <a
            href="https://play.google.com/store/apps/details?id=com.dodam.bicycleairpressuremaster"
            class="app-link"
          >
            <span class="app-text">자전거공기압계산기</span>
            <span class="app-subtitle">안드로이드 앱 다운로드</span>
          </a>
        </div>

        <div class="footer-links">
          <a href="./privacy-policy.html" class="footer-link"
            >개인정보처리방침</a
          >
          <span class="divider">•</span>
          <a href="./terms-of-service.html" class="footer-link">이용약관</a>
        </div>

        <div class="copyright">
          © 도담소프트(DoDamSoft) 2025. All Rights Reserved.
        </div>

        <ins
          class="kakao_ad_area"
          style="display: none"
          data-ad-unit="DAN-dyddLLg4dLJwTgA3"
          data-ad-width="320"
          data-ad-height="50"
        ></ins>
        <script
          type="text/javascript"
          src="//t1.daumcdn.net/kas/static/ba.min.js"
          async
        ></script>
      </div>
    </footer>
  </body>
</html>
